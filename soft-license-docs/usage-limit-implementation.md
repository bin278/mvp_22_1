# ä½¿ç”¨æ¬¡æ•°é™åˆ¶åŠŸèƒ½å®ç°

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. åŠŸèƒ½æ¦‚è¿°

å½“ç”¨æˆ·å°†æœ¬æœˆä»£ç ç”Ÿæˆæ¬¡æ•°ç”¨å®Œåï¼Œç³»ç»Ÿä¼šï¼š
- âœ… ç¦ç”¨ç”Ÿæˆä»£ç æŒ‰é’®
- âœ… ç¦ç”¨ä¿®æ”¹ä»£ç æŒ‰é’®
- âœ… ç‚¹å‡»æŒ‰é’®æ—¶æ˜¾ç¤ºæç¤ºä¿¡æ¯
- âœ… åœ¨ header ä¸­æ˜¾ç¤ºè­¦å‘Šé¢œè‰²
- âœ… æ˜¾ç¤ºå¼¹å‡ºå¼æç¤ºæ ‡ç­¾

---

## ğŸ“Š å‰©ä½™æ¬¡æ•°æ˜¾ç¤ºé€»è¾‘

### Header ä¸­çš„é¢œè‰²çŠ¶æ€

å‰©ä½™æ¬¡æ•°å¡ç‰‡ä¼šæ ¹æ®å‰©ä½™æ¬¡æ•°æ˜¾ç¤ºä¸åŒçš„é¢œè‰²ï¼š

| å‰©ä½™æ¬¡æ•° | èƒŒæ™¯é¢œè‰² | æ–‡å­—é¢œè‰² | åŠ¨ç”»æ•ˆæœ | è¯´æ˜ |
|---------|---------|---------|---------|------|
| **æ— é™** | è“è‰²æ¸å˜ | è“è‰² | æ—  | Enterprise ç‰ˆ |
| **> 5 æ¬¡** | è“è‰²æ¸å˜ | è“è‰² | æ—  | æ­£å¸¸çŠ¶æ€ |
| **1-5 æ¬¡** | æ©™è‰²æ¸å˜ | æ©™è‰² | æ—  | âš ï¸ å³å°†ç”¨å®Œ |
| **0 æ¬¡** | çº¢è‰²æ¸å˜ | çº¢è‰² | é—ªçƒ | âŒ å·²ç”¨å®Œ |

### ä»£ç ä½ç½®

[app/generate/page.tsx:1619-1662](app/generate/page.tsx#L1619-L1662)

```typescript
<div className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg border ${
  codeUsage.isUnlimited
    ? 'bg-gradient-to-r from-blue-50 to-indigo-50 ...'  // æ— é™ï¼šè“è‰²
    : codeUsage.remaining <= 0
    ? 'bg-gradient-to-r from-red-50 to-red-100 ... animate-pulse'  // ç”¨å®Œï¼šçº¢è‰²+é—ªçƒ
    : codeUsage.remaining <= 5
    ? 'bg-gradient-to-r from-orange-50 to-amber-50 ...'  // å¿«ç”¨å®Œï¼šæ©™è‰²
    : 'bg-gradient-to-r from-blue-50 to-indigo-50 ...'  // æ­£å¸¸ï¼šè“è‰²
}`}>
```

---

## ğŸš« ç”Ÿæˆä»£ç æŒ‰é’®é™åˆ¶

### æŒ‰é’®ç¦ç”¨æ¡ä»¶

å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œç”ŸæˆæŒ‰é’®ä¼šè¢«ç¦ç”¨ï¼š
1. `prompt` ä¸ºç©º
2. æ­£åœ¨ç”Ÿæˆä¸­ (`isGenerating`)
3. **å‰©ä½™æ¬¡æ•° <= 0** (æ–°å¢)

### æŒ‰é’®è§†è§‰åé¦ˆ

**æ­£å¸¸çŠ¶æ€**:
- èƒŒæ™¯è‰²: `bg-accent hover:bg-accent/90`
- å¯ä»¥ç‚¹å‡»

**æ¬¡æ•°ç”¨å®Œæ—¶**:
- èƒŒæ™¯è‰²: `bg-gray-400 cursor-not-allowed`
- æ— æ³•ç‚¹å‡»
- æ˜¾ç¤ºç°è‰²ä¸å¯ç”¨çŠ¶æ€

### ä»£ç ä½ç½®

[app/generate/page.tsx:1896-1927](app/generate/page.tsx#L1896-L1927)

```typescript
<Button
  onClick={handleGenerate}
  disabled={
    !prompt.trim() ||
    isGenerating ||
    (codeUsage && !codeUsage.isUnlimited && codeUsage.remaining <= 0)  // âœ… æ–°å¢æ¡ä»¶
  }
  className={(codeUsage && !codeUsage.isUnlimited && codeUsage.remaining <= 0)
    ? "bg-gray-400 cursor-not-allowed"
    : "bg-accent hover:bg-accent/90"
}>
```

### å¼¹å‡ºå¼æç¤º

å½“å‰©ä½™æ¬¡æ•° = 0 æ—¶ï¼ŒæŒ‰é’®ä¸Šæ–¹ä¼šæ˜¾ç¤ºä¸€ä¸ªçº¢è‰²æç¤ºæ ‡ç­¾ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 30/30 used - Upgrade to continue    â”‚  â† çº¢è‰²é—ªçƒæç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           [ç”Ÿæˆä»£ç æŒ‰é’® (ç°è‰²)]
```

**æç¤ºå†…å®¹**:
- è‹±æ–‡: `{limit}/{limit} used - Upgrade to continue`
- ä¸­æ–‡: `å·²ä½¿ç”¨ {limit}/{limit} æ¬¡ - å‡çº§åç»§ç»­`

**æ ·å¼ç‰¹ç‚¹**:
- çº¢è‰²èƒŒæ™¯ (`bg-red-500`)
- ç™½è‰²æ–‡å­—
- åœ†è§’é˜´å½± (`rounded-lg shadow-lg`)
- è·³åŠ¨åŠ¨ç”» (`animate-bounce`)
- æŒ‰é’®ä¸Šæ–¹ 12px (`-top-12`)

### ä»£ç ä½ç½®

[app/generate/page.tsx:1913-1921](app/generate/page.tsx#L1913-L1921)

---

## ğŸ“ ä¿®æ”¹ä»£ç æŒ‰é’®é™åˆ¶

ä¿®æ”¹ä»£ç æŒ‰é’®ä¹Ÿæœ‰ç›¸åŒçš„é™åˆ¶é€»è¾‘ï¼š

### ç¦ç”¨æ¡ä»¶

1. ä¿®æ”¹æŒ‡ä»¤ä¸ºç©º
2. æ­£åœ¨ä¿®æ”¹ä¸­
3. **å‰©ä½™æ¬¡æ•° <= 0** (æ–°å¢)

### ä»£ç ä½ç½®

[app/generate/page.tsx:1863-1893](app/generate/page.tsx#L1863-L1893)

```typescript
<Button
  onClick={handleModifyCode}
  disabled={
    isModifying ||
    !modifyInstruction.trim() ||
    (codeUsage && !codeUsage.isUnlimited && codeUsage.remaining <= 0)  // âœ… æ–°å¢
  }
  className={(codeUsage && !codeUsage.isUnlimited && codeUsage.remaining <= 0)
    ? "bg-gray-400 cursor-not-allowed"
    : "bg-accent hover:bg-accent/90"
}>
```

---

## ğŸ” ç‚¹å‡»æç¤ºé€»è¾‘

### handleGenerate() å‡½æ•°ä¸­çš„æ£€æŸ¥

[app/generate/page.tsx:940-955](app/generate/page.tsx#L940-L955)

```typescript
const handleGenerate = async () => {
  if (!prompt.trim()) return

  // âœ… æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°é™åˆ¶
  if (codeUsage && !codeUsage.isUnlimited && codeUsage.remaining <= 0) {
    const message = language === 'en'
      ? `You have reached your monthly limit of ${codeUsage.limit} code generations.\n\nPlease upgrade your plan to continue generating code.`
      : `æ‚¨å·²è¾¾åˆ°æœ¬æœˆçš„ ${codeUsage.limit} æ¬¡ä»£ç ç”Ÿæˆé™åˆ¶ã€‚\n\nè¯·å‡çº§æ‚¨çš„è®¢é˜…è®¡åˆ’ä»¥ç»§ç»­ç”Ÿæˆä»£ç ã€‚`

    alert(message)
    return  // é˜»æ­¢ç”Ÿæˆ
  }

  // ... ç»§ç»­ç”Ÿæˆé€»è¾‘
}
```

### handleModifyCode() å‡½æ•°ä¸­çš„æ£€æŸ¥

[app/generate/page.tsx:1230-1239](app/generate/page.tsx#L1230-L1239)

```typescript
const handleModifyCode = async () => {
  if (!modifyInstruction.trim() || !generatedProject) return

  // âœ… æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°é™åˆ¶
  if (codeUsage && !codeUsage.isUnlimited && codeUsage.remaining <= 0) {
    const message = language === 'en'
      ? `You have reached your monthly limit of ${codeUsage.limit} code generations.\n\nPlease upgrade your plan to continue modifying code.`
      : `æ‚¨å·²è¾¾åˆ°æœ¬æœˆçš„ ${codeUsage.limit} æ¬¡ä»£ç ç”Ÿæˆé™åˆ¶ã€‚\n\nè¯·å‡çº§æ‚¨çš„è®¢é˜…è®¡åˆ’ä»¥ç»§ç»­ä¿®æ”¹ä»£ç ã€‚`

    alert(message)
    return  // é˜»æ­¢ä¿®æ”¹
  }

  // ... ç»§ç»­ä¿®æ”¹é€»è¾‘
}
```

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒæµç¨‹

### åœºæ™¯ 1: æ¬¡æ•°å……è¶³ (> 5 æ¬¡)

1. **Header æ˜¾ç¤º**: è“è‰²å¡ç‰‡ `25/30 å‰©ä½™`
2. **æŒ‰é’®çŠ¶æ€**: æ­£å¸¸å¯ç‚¹å‡»
3. **ç‚¹å‡»æŒ‰é’®**: æ­£å¸¸ç”Ÿæˆä»£ç 
4. **ä½¿ç”¨å**: å‰©ä½™æ¬¡æ•° -1

### åœºæ™¯ 2: æ¬¡æ•°å³å°†ç”¨å®Œ (1-5 æ¬¡)

1. **Header æ˜¾ç¤º**: ğŸŸ¡ æ©™è‰²å¡ç‰‡ `3/30 å‰©ä½™` (è­¦å‘Š)
2. **æŒ‰é’®çŠ¶æ€**: æ­£å¸¸å¯ç‚¹å‡»
3. **ç‚¹å‡»æŒ‰é’®**: æ­£å¸¸ç”Ÿæˆä»£ç 
4. **æç¤º**: ç”¨æˆ·åº”è¯¥çœ‹åˆ°å³å°†ç”¨å®Œçš„æ©™è‰²è­¦å‘Š

### åœºæ™¯ 3: æ¬¡æ•°å·²ç”¨å®Œ (0 æ¬¡)

1. **Header æ˜¾ç¤º**: ğŸ”´ çº¢è‰²é—ªçƒå¡ç‰‡ `0/30 å‰©ä½™`
2. **æŒ‰é’®çŠ¶æ€**: ç°è‰²ç¦ç”¨çŠ¶æ€
3. **æŒ‰é’®ä¸Šæ–¹**: çº¢è‰²è·³åŠ¨æç¤º "å·²ä½¿ç”¨ 30/30 æ¬¡ - å‡çº§åç»§ç»­"
4. **ç‚¹å‡»æŒ‰é’®**: å¼¹å‡º alert æç¤º

**Alert æç¤ºå†…å®¹**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‚¨å·²è¾¾åˆ°æœ¬æœˆçš„ 30 æ¬¡ä»£ç ç”Ÿæˆé™åˆ¶ã€‚      â”‚
â”‚                                         â”‚
â”‚ è¯·å‡çº§æ‚¨çš„è®¢é˜…è®¡åˆ’ä»¥ç»§ç»­ç”Ÿæˆä»£ç ã€‚      â”‚
â”‚                                         â”‚
â”‚                   [ ç¡®å®š ]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ 4: Enterprise ç‰ˆ (æ— é™)

1. **Header æ˜¾ç¤º**: è“è‰²å¡ç‰‡ `âˆ/âˆ å‰©ä½™`
2. **æŒ‰é’®çŠ¶æ€**: å§‹ç»ˆå¯ç‚¹å‡»
3. **æ— é™åˆ¶**: ä¸æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°

---

## ğŸ“Š ä¸åŒè®¢é˜…è®¡åˆ’çš„é™åˆ¶

| è®¡åˆ’ | æ¯æœˆé™é¢ | å‰©ä½™ = 0 æ—¶ | æ˜¯å¦ç¦ç”¨ |
|------|---------|------------|---------|
| **Free** | 30 æ¬¡ | âœ… ç¦ç”¨ | æ˜¯ |
| **Pro** | 500 æ¬¡ | âœ… ç¦ç”¨ | æ˜¯ |
| **Enterprise** | æ— é™ | âŒ ä¸ç¦ç”¨ | å¦ |

---

## ğŸ”„ æ•°æ®åˆ·æ–°

### åˆ·æ–°æ—¶æœº

ä½¿ç”¨æ¬¡æ•°æ•°æ®ä¼šåœ¨ä»¥ä¸‹æ—¶æœºåˆ·æ–°ï¼š
1. é¡µé¢é¦–æ¬¡åŠ è½½
2. ç”¨æˆ·ç™»å½•çŠ¶æ€å˜åŒ–
3. **ç”Ÿæˆä»£ç å**ï¼ˆå»ºè®®å®ç°ï¼‰

### å»ºè®®æ”¹è¿›

åœ¨ç”Ÿæˆä»£ç æˆåŠŸåç«‹å³åˆ·æ–°ä½¿ç”¨æ¬¡æ•°ï¼š

```typescript
// åœ¨ handleGenerate æˆ– handleModifyCode æˆåŠŸå
const refreshUsage = async () => {
  if (authSession?.accessToken) {
    const response = await fetch('/api/subscription/check-usage', {
      headers: { 'Authorization': `Bearer ${authSession.accessToken}` },
    })
    if (response.ok) {
      const data = await response.json()
      setCodeUsage(data.usage)
    }
  }
}

// ç”ŸæˆæˆåŠŸåè°ƒç”¨
await refreshUsage()
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•æ¬¡æ•°å……è¶³

```bash
# 1. ç™»å½• Free è´¦æˆ·
# 2. ç¡®è®¤å‰©ä½™æ¬¡æ•° > 5
# 3. è¾“å…¥ prompt å¹¶ç‚¹å‡»ç”Ÿæˆ
# é¢„æœŸ: æ­£å¸¸ç”Ÿæˆï¼Œæ¬¡æ•° -1
```

### 2. æµ‹è¯•æ¬¡æ•°å³å°†ç”¨å®Œ

```bash
# 1. æŸ¥çœ‹å‰©ä½™æ¬¡æ•° <= 5
# é¢„æœŸ: Header æ˜¾ç¤ºæ©™è‰²è­¦å‘Š
# 2. ä»ç„¶å¯ä»¥ç”Ÿæˆ
# 3. ç”Ÿæˆæ¬¡æ•°ç”¨å®Œå
# é¢„æœŸ: Header å˜çº¢è‰²ï¼ŒæŒ‰é’®ç¦ç”¨
```

### 3. æµ‹è¯•æ¬¡æ•°å·²ç”¨å®Œ

```bash
# 1. ç¡®è®¤å‰©ä½™æ¬¡æ•° = 0
# é¢„æœŸ:
# - Header æ˜¾ç¤ºçº¢è‰²é—ªçƒå¡ç‰‡
# - æŒ‰é’®å˜ä¸ºç°è‰²
# - æŒ‰é’®ä¸Šæ–¹æ˜¾ç¤ºçº¢è‰²æç¤º
# 2. ç‚¹å‡»ç”ŸæˆæŒ‰é’®
# é¢„æœŸ: å¼¹å‡º alert æç¤º
# 3. å°è¯•ä¿®æ”¹ä»£ç 
# é¢„æœŸ: åŒæ ·å¼¹å‡º alert æç¤º
```

### 4. æµ‹è¯• Enterprise ç‰ˆ

```bash
# 1. ç™»å½• Enterprise è´¦æˆ·
# é¢„æœŸ:
# - æ˜¾ç¤º âˆ/âˆ
# - æŒ‰é’®å§‹ç»ˆå¯ç‚¹å‡»
# - æ— ä»»ä½•é™åˆ¶
```

---

## ğŸ“ ä¿®æ”¹çš„ä»£ç ä½ç½®

| åŠŸèƒ½ | æ–‡ä»¶ä½ç½® |
|------|----------|
| Header è­¦å‘Šé¢œè‰² | [app/generate/page.tsx:1619-1662](app/generate/page.tsx#L1619-L1662) |
| ç”ŸæˆæŒ‰é’®ç¦ç”¨ | [app/generate/page.tsx:1896-1927](app/generate/page.tsx#L1896-L1927) |
| ä¿®æ”¹æŒ‰é’®ç¦ç”¨ | [app/generate/page.tsx:1863-1893](app/generate/page.tsx#L1863-L1893) |
| handleGenerate æ£€æŸ¥ | [app/generate/page.tsx:940-955](app/generate/page.tsx#L940-L955) |
| handleModifyCode æ£€æŸ¥ | [app/generate/page.tsx:1230-1239](app/generate/page.tsx#L1230-L1239) |

---

## âœ… å®ŒæˆçŠ¶æ€

- âœ… ç”Ÿæˆä»£ç æŒ‰é’®æ¬¡æ•°é™åˆ¶
- âœ… ä¿®æ”¹ä»£ç æŒ‰é’®æ¬¡æ•°é™åˆ¶
- âœ… Header è­¦å‘Šé¢œè‰²æ˜¾ç¤º
- âœ… æŒ‰é’®ç¦ç”¨çŠ¶æ€è§†è§‰åé¦ˆ
- âœ… å¼¹å‡ºå¼æç¤ºæ ‡ç­¾
- âœ… Alert å¯¹è¯æ¡†æç¤º
- âœ… ä¸­è‹±æ–‡æ”¯æŒ
- âœ… Enterprise ç‰ˆæ— é™ä¾‹å¤–
- âœ… æ·±è‰²æ¨¡å¼æ”¯æŒ

---

## ğŸ’¡ æœªæ¥æ”¹è¿›å»ºè®®

1. **å®æ—¶åˆ·æ–°**: ç”ŸæˆæˆåŠŸåç«‹å³åˆ·æ–°ä½¿ç”¨æ¬¡æ•°
2. **Toast æç¤º**: ä½¿ç”¨ Toast æ›¿ä»£ alertï¼ˆæ›´å¥½çš„ UXï¼‰
3. **å‡çº§å¼•å¯¼**: æä¾›å¿«æ·å‡çº§æŒ‰é’®
4. **å€’è®¡æ—¶æç¤º**: æ˜¾ç¤ºæœ¬æœˆå‰©ä½™å¤©æ•°
5. **å†å²ç»Ÿè®¡**: æ˜¾ç¤ºä½¿ç”¨é‡è¶‹åŠ¿å›¾è¡¨
6. **é‚®ä»¶æé†’**: æ¬¡æ•°å¿«ç”¨å®Œæ—¶å‘é€é‚®ä»¶æé†’

---

## ğŸ‰ æ€»ç»“

ç°åœ¨å½“ç”¨æˆ·æŠŠæ¬¡æ•°ç”¨å®Œåï¼š
1. âœ… Header æ˜¾ç¤ºçº¢è‰²é—ªçƒè­¦å‘Š
2. âœ… ç”Ÿæˆ/ä¿®æ”¹æŒ‰é’®å˜ä¸ºç°è‰²ç¦ç”¨çŠ¶æ€
3. âœ… æŒ‰é’®ä¸Šæ–¹æ˜¾ç¤ºçº¢è‰²è·³åŠ¨æç¤º
4. âœ… ç‚¹å‡»æ—¶å¼¹å‡º alert è¯´æ˜æƒ…å†µ
5. âœ… Enterprise ç‰ˆä¸å—å½±å“

è¿™ä¸ªè®¾è®¡æ—¢æ¸…æ™°åœ°å‘ŠçŸ¥ç”¨æˆ·é™åˆ¶ï¼Œåˆæä¾›äº†å‹å¥½çš„å¼•å¯¼ï¼Œé¼“åŠ±ç”¨æˆ·å‡çº§è®¢é˜…ä»¥ç»§ç»­ä½¿ç”¨æœåŠ¡ã€‚
